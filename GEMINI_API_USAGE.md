# Gemini API 使用量と料金分析

## 現在の使用状況

### API使用箇所
1. **AI要約生成** (`generateMarkdownSummary`)
   - Markdown出力タブの「✨ AIで要約を作成」ボタン
   - 使用頻度: ユーザーが手動で実行

2. **次のトレーニング提案** (`suggestNextWorkout`)
   - ヘッダーの「💡 次のおすすめ」ボタン
   - 使用頻度: ユーザーが手動で実行

### 使用モデル
- `gemini-3-flash-preview` (Gemini 3 Flash Preview)

## 料金体系（2026年）

### Gemini 3 Flash Preview（推定）
- **入力**: 約 $0.30 / 1Mトークン
- **出力**: 約 $2.50 / 1Mトークン

※ Gemini 3 Flash Previewは新しいモデルのため、Gemini 2.5 Flashの料金を参考にしています。

### トークン換算
- **1トークン** ≈ 4文字 ≈ 0.75単語（日本語）
- **1,000円** ≈ **$6.67** (1ドル=150円と仮定)

## 1回のAPI呼び出しあたりのトークン数（推定）

### 1. AI要約生成 (`generateMarkdownSummary`)

**入力トークン:**
- プロンプト: 約150トークン（600文字）
- セッションデータ（1セッションあたり）:
  - 1セッション: 約200-400トークン（800-1600文字）
  - 5セッション: 約1,000-2,000トークン
  - 10セッション: 約2,000-4,000トークン

**出力トークン:**
- Markdown要約: 約500-1,500トークン（2,000-6,000文字）

**合計（1セッションの場合）:**
- 入力: 約350-550トークン
- 出力: 約500-1,500トークン
- **合計: 約850-2,050トークン**

**合計（5セッションの場合）:**
- 入力: 約1,150-2,150トークン
- 出力: 約800-2,000トークン
- **合計: 約1,950-4,150トークン**

### 2. 次のトレーニング提案 (`suggestNextWorkout`)

**入力トークン:**
- プロンプト: 約100トークン（400文字）
- セッションデータ: 約200-400トークン（800-1600文字）

**出力トークン:**
- 提案テキスト: 約200-400トークン（800-1600文字）

**合計:**
- 入力: 約300-500トークン
- 出力: 約200-400トークン
- **合計: 約500-900トークン**

## 料金計算（$6.67 = 1,000円の予算）

### 1セッションのAI要約生成の場合
- トークン数: 約850-2,050トークン
- 料金: 約 $0.00026 - $0.00062 / 回
- **1,000円で約10,700 - 25,600回実行可能**

### 5セッションのAI要約生成の場合
- トークン数: 約1,950-4,150トークン
- 料金: 約 $0.00059 - $0.00126 / 回
- **1,000円で約5,300 - 11,300回実行可能**

### 次のトレーニング提案の場合
- トークン数: 約500-900トークン
- 料金: 約 $0.00015 - $0.00027 / 回
- **1,000円で約24,700 - 44,500回実行可能**

## 毎日記録を残した場合の使用量（1人あたり）

### 想定シナリオ
- **毎日1回のトレーニング記録**
- **週1回AI要約を生成**（7セッション分）
- **週2回次のトレーニング提案を使用**

### 月間使用量（1人）
- AI要約: 4回/月 × 7セッション = 約7,800-16,600トークン/月
- トレーニング提案: 8回/月 = 約4,000-7,200トークン/月
- **合計: 約11,800-23,800トークン/月**
- **料金: 約 $0.0035 - $0.0072 / 月（約0.5-1.1円/月）**

### 1,000円で何人まで許容できるか

**1人あたりの月額料金: 約0.5-1.1円**

**許容可能人数:**
- **月額**: 約900-2,000人
- **年間**: 約900-2,000人（月額料金が継続する場合）

## 注意事項

1. **実際の料金は変動する可能性があります**
   - Gemini 3 Flash Previewの正確な料金は公式ドキュメントを確認してください
   - 為替レートの変動により、円換算は変わります

2. **使用量はデータ量に依存します**
   - セッション数が多いほど、トークン数が増加します
   - 種目数やセット数が多い場合も増加します

3. **無料枠の確認**
   - Gemini APIには無料枠がある可能性があります
   - 無料枠内であれば追加コストはかかりません

4. **推奨対策**
   - API使用量の監視機能を追加
   - 月間使用量の上限を設定
   - ユーザーごとの使用量制限を検討

## 推奨設定

### 使用量制限の実装
- 1ユーザーあたりの月間API呼び出し回数を制限
- 例: 1ユーザーあたり月10回まで

### コスト監視
- Google Cloud ConsoleでAPI使用量を監視
- 月間予算アラートを設定（例: 800円で警告）
